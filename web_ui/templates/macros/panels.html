{% macro format_runtime(minutes) %}
  {% if minutes %}
    {% set hours = minutes // 60 %}
    {% set mins = minutes % 60 %}
    {% if hours > 0 %}
      {{ hours }}h{% if mins > 0 %} {{ mins }}m{% endif %}
    {% else %}
      {{ mins }}m
    {% endif %}
  {% else %}
    â€”
  {% endif %}
{% endmacro %}

{% macro render_cinema_panel(current_releases, next_month_releases, now, next_month) %}
  <div class="panel cinema-panel">
    <h2>ğŸŸï¸ Cinema Releases â€“ {{ now.strftime('%B %Y') }}</h2>
    {% if current_releases %}
      <table class="release-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>ğŸ“… Date</th>
            <th>â±ï¸ Runtime</th>
            <th>ğŸ›¡ï¸ Certification</th>
            <th>ğŸ¢ Distributor</th>
            <th>ğŸ­ Genre</th>
          </tr>
        </thead>
        <tbody>
          {% for release in current_releases %}
          <tr>
            <td><a href="{{ release.source_url }}" target="_blank">{{ release.title }}</a></td>
            <td>{{ release.release_date.strftime('%d/%m/%Y') if release.release_date else "Unknown" }}</td>
            <td>{{ format_runtime(release.runtime) }}</td>
            <td>{{ release.certification or "Unrated" }}</td>
            <td>{{ release.distributor or "Unknown" }}</td>
            <td>{{ release.genre or "Unknown" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="news-empty">
        ğŸš« No cinema releases found for this month.<br>
        <button onclick="location.reload()">ğŸ”„ Retry</button>
      </div>
    {% endif %}

    <h3 class="next-month-header">ğŸ“… Coming Soon â€“ {{ next_month.strftime('%B %Y') }}</h3>
    {% if next_month_releases %}
      <table class="release-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>ğŸ“… Date</th>
            <th>â±ï¸ Runtime</th>
            <th>ğŸ›¡ï¸ Certification</th>
            <th>ğŸ¢ Distributor</th>
            <th>ğŸ­ Genre</th>
          </tr>
        </thead>
        <tbody>
          {% for release in next_month_releases %}
          <tr>
            <td><a href="{{ release.source_url }}" target="_blank">{{ release.title }}</a></td>
            <td>{{ release.release_date.strftime('%d/%m/%Y') if release.release_date else "Unknown" }}</td>
            <td>{{ format_runtime(release.runtime) }}</td>
            <td>{{ release.certification or "Unrated" }}</td>
            <td>{{ release.distributor or "Unknown" }}</td>
            <td>{{ release.genre or "Unknown" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="news-empty">
        ğŸš« No upcoming releases found for next month.
      </div>
    {% endif %}
  </div>
{% endmacro %}


{% macro render_tv_panel(shows, now) %}
  <div class="panel tv-panel">
    <h2>ğŸ“º TV Releases â€“ {{ now.strftime('%B %Y') }}</h2>
    {% if shows %}
      <table class="release-table">
        <thead>
          <tr>
            <th>Title</th>
            <th>ğŸ“… Date</th>
            <th>â±ï¸ Runtime</th>
            <th>ğŸ¢ Broadcaster</th>
            <th>ğŸ­ Genre</th>
          </tr>
        </thead>
        <tbody>
          {% for show in shows %}
          <tr>
            <td><a href="{{ show.source_url }}" target="_blank">{{ show.title }}</a></td>
            <td>{{ show.release_date.strftime('%d/%m/%Y') if show.release_date else "Unknown" }}</td>
            <td>{{ format_runtime(show.runtime) }}</td>
            <td>{{ show.platform or "Unknown" }}</td>
            <td>{{ show.genre or "Unknown" }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="news-empty">
        ğŸš« No TV releases found for this month.<br>
        <button onclick="location.reload()">ğŸ”„ Retry</button>
      </div>
    {% endif %}
  </div>
{% endmacro %}
