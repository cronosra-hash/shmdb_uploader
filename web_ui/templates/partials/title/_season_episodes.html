{% if title.type == 'tv' and season_map %}
<div class="panel">
  <h2>Seasons & Episodes</h2>
  <div class="nav-panel">
    {% for season in season_map %}
    <div class="season-panel">
      <!-- Season Toggle -->
      <button class="season-toggle flex justify-between items-center w-full" aria-expanded="false"
        aria-controls="season-{{ season.season_number }}">
        <span>
          📁 Season {{ season.season_number }} — {{ season.season_name or 'Untitled' }}
          {% if season.average_rating %}
          <span class="rating ml-2">⭐ {{ season.average_rating }} </span>
          {% endif %}
          {% if season.date_from and season.date_to %}
          <span class="text-xs text-gray-500 ml-2"> - 📅 {{ season.date_from }} → {{ season.date_to }}</span>
          {% endif %}
        </span>
        <span class="toggle-icon">▼</span>
      </button>
      <!-- Episode List -->
      <div id="season-{{ season.season_number }}" class="season-episodes" style="display: none;">
        {% for ep in season.episodes %}
        <div class="episode-card">
          <div class="episode-header">
            <span>S{{ season.season_number }}E{{ ep.episode_number }} — {{ ep.episode_name }}</span>
            <span>{{ ep.air_date_formatted }}</span>
          </div>

          {% if ep.overview %}
          <p class="episode-overview">{{ ep.overview }}</p>
          {% endif %}

          <div class="episode-meta">
            {% if ep.rating %}
            <span class="rating">⭐ {{ ep.rating }}</span>
            {% endif %}
            {% if ep.watched_date_formatted %}
            <span class="watched">👁️ {{ ep.watched_date_formatted}}</span>
            {% endif %}
          </div>
        </div>
        {% endfor %}
      </div>
    </div>
    {% endfor %}
  </div>
</div>
{% endif %}

<script>
  document.addEventListener("DOMContentLoaded", () => {
    document.querySelectorAll(".season-toggle").forEach(button => {
      const panelId = button.getAttribute("aria-controls");
      const panel = document.getElementById(panelId);
      const icon = button.querySelector(".toggle-icon");

      button.addEventListener("click", () => {
        const isHidden = panel.style.display === "none";
        panel.style.display = isHidden ? "block" : "none";
        button.setAttribute("aria-expanded", String(isHidden));
        if (icon) icon.textContent = isHidden ? "▲" : "▼";
      });
    });
  });
</script>